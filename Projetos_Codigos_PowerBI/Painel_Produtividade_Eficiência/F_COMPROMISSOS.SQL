WITH FichaFiltrada AS (
    SELECT PASTA, PRODUTO, DEPARTAMENTO
    FROM JURIDICO.FichaProcessual WITH(NOLOCK)
    WHERE DEPARTAMENTO = 'COBRANÃ‡A'
),
Compromissos AS (
    SELECT 
        COMP.PASTA,
        COMP.CHAVECOMP AS CHAVE,
        COMP.DATA_CONCLUSAO_COMPROMISSO AS DATA_EVENTO,
        COMP.TIPO_COMPROMISSO AS TIPO_EVENTO,
        COMP.USUARIO_CONCLUSAO_COMPROMISSO AS USUARIO,
        FP.PRODUTO,
        'COMPROMISSO' AS ORIGEM
    FROM JURIDICO.Compromissos_Concluidos COMP WITH(NOLOCK)
    INNER JOIN FichaFiltrada FP ON COMP.PASTA = FP.PASTA
    WHERE COMP.DATA_CONCLUSAO_COMPROMISSO >= '01/01/2024'
)

SELECT * FROM Compromissos;
